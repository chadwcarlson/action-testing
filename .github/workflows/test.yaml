---
name: Commit to auto-updates

on:
    create

jobs:
    update:
        runs-on: ubuntu-latest
        steps: 
          - name: Get branch
            if: github.ref == 'refs/heads/auto-updates'
            uses: actions/checkout@v2
            with:
                ref: 'auto-updates'
          - name: Setup Node.js
            uses: actions/setup-node@v2
            with:
                node-version: '14.x'
          - name: Install dependencies
            run: npm install
          - name: Update entries
            id: updateData
            run: node update.js
          - name: Verify update
            run: npm test
          - name: Commit changes
            uses: stefanzweifel/git-auto-commit-action@v4
            with:
                commit_message: "Data auto-update."
                branch: 'auto-updates'
                commit_user_name: "Platform.sh autoupdater"
          - name: Create Pull Request
            id: cpr
            uses: peter-evans/create-pull-request@v3
            with:
                token: ${{ secrets.GHTOKEN }}
                branch: 'auto-updates'
                base: master
                title: '[Auto] Data update'
                body: |
                    Update report
                    - Updated with *today's* date
                    - Auto-generated by [create-pull-request][1]

                    [1]: https://github.com/peter-evans/create-pull-request
                labels: |
                    report
                    automated pr